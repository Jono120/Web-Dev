<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "a7587943d38d095de8613e1b508609f5",
  "translation_date": "2025-08-29T11:09:39+00:00",
  "source_file": "5-browser-extension/2-forms-browsers-local-storage/README.md",
  "language_code": "sk"
}
-->
# Projekt roz≈°√≠renia prehliadaƒça, ƒças≈• 2: Volanie API, pou≈æitie lok√°lneho √∫lo≈æiska

## Kv√≠z pred predn√°≈°kou

[Kv√≠z pred predn√°≈°kou](https://ff-quizzes.netlify.app/web/quiz/25)

### √övod

V tejto lekcii budete vola≈• API prostredn√≠ctvom odoslania formul√°ra v√°≈°ho roz≈°√≠renia prehliadaƒça a zobrazova≈• v√Ωsledky v roz≈°√≠ren√≠. Okrem toho sa nauƒç√≠te, ako uklada≈• √∫daje do lok√°lneho √∫lo≈æiska prehliadaƒça na bud√∫ce pou≈æitie.

‚úÖ Postupujte podƒæa oƒç√≠slovan√Ωch segmentov v pr√≠slu≈°n√Ωch s√∫boroch, aby ste vedeli, kam umiestni≈• svoj k√≥d.

### Nastavenie prvkov na manipul√°ciu v roz≈°√≠ren√≠:

Do tejto chv√≠le ste vytvorili HTML pre formul√°r a v√Ωsledkov√Ω `<div>` pre va≈°e roz≈°√≠renie prehliadaƒça. Odteraz budete pracova≈• v s√∫bore `/src/index.js` a postupne budova≈• svoje roz≈°√≠renie. Odk√°≈æte na [predch√°dzaj√∫cu lekciu](../1-about-browsers/README.md) o nastaven√≠ projektu a procese zostavovania.

Pracujte vo svojom s√∫bore `index.js` a zaƒçnite vytvoren√≠m niekoƒæk√Ωch `const` premenn√Ωch na uchovanie hodn√¥t spojen√Ωch s r√¥znymi poliami:

```JavaScript
// form fields
const form = document.querySelector('.form-data');
const region = document.querySelector('.region-name');
const apiKey = document.querySelector('.api-key');

// results
const errors = document.querySelector('.errors');
const loading = document.querySelector('.loading');
const results = document.querySelector('.result-container');
const usage = document.querySelector('.carbon-usage');
const fossilfuel = document.querySelector('.fossil-fuel');
const myregion = document.querySelector('.my-region');
const clearBtn = document.querySelector('.clear-btn');
```

V≈°etky tieto polia s√∫ referencovan√© podƒæa ich CSS triedy, ako ste ich nastavili v HTML v predch√°dzaj√∫cej lekcii.

### Pridanie posluch√°ƒçov udalost√≠

ƒéalej pridajte posluch√°ƒçov udalost√≠ pre formul√°r a tlaƒçidlo na vymazanie, ktor√© resetuje formul√°r, aby sa pri odoslan√≠ formul√°ra alebo kliknut√≠ na tlaƒçidlo reset nieƒço stalo. Na konci s√∫boru pridajte volanie na inicializ√°ciu aplik√°cie:

```JavaScript
form.addEventListener('submit', (e) => handleSubmit(e));
clearBtn.addEventListener('click', (e) => reset(e));
init();
```

‚úÖ V≈°imnite si skr√°ten√Ω z√°pis pou≈æit√Ω na poƒç√∫vanie udalost√≠ odoslania alebo kliknutia a sp√¥sob, ak√Ωm sa udalos≈• odovzd√°va funkci√°m handleSubmit alebo reset. Dok√°≈æete nap√≠sa≈• ekvivalent tohto skr√°ten√©ho z√°pisu v dlh≈°om form√°te? Ktor√Ω preferujete?

### Vytvorenie funkci√≠ init() a reset():

Teraz vytvor√≠te funkciu, ktor√° inicializuje roz≈°√≠renie, naz√Ωvan√∫ init():

```JavaScript
function init() {
	//if anything is in localStorage, pick it up
	const storedApiKey = localStorage.getItem('apiKey');
	const storedRegion = localStorage.getItem('regionName');

	//set icon to be generic green
	//todo

	if (storedApiKey === null || storedRegion === null) {
		//if we don't have the keys, show the form
		form.style.display = 'block';
		results.style.display = 'none';
		loading.style.display = 'none';
		clearBtn.style.display = 'none';
		errors.textContent = '';
	} else {
        //if we have saved keys/regions in localStorage, show results when they load
        displayCarbonUsage(storedApiKey, storedRegion);
		results.style.display = 'none';
		form.style.display = 'none';
		clearBtn.style.display = 'block';
	}
};

function reset(e) {
	e.preventDefault();
	//clear local storage for region only
	localStorage.removeItem('regionName');
	init();
}

```

V tejto funkcii je zauj√≠mav√° logika. Pri jej ƒç√≠tan√≠ dok√°≈æete pochopi≈•, ƒço sa deje?

- s√∫ nastaven√© dve `const`, ktor√© kontroluj√∫, ƒçi pou≈æ√≠vateƒæ ulo≈æil APIKey a region√°lny k√≥d do lok√°lneho √∫lo≈æiska.
- ak je niektor√° z t√Ωchto hodn√¥t null, zobrazte formul√°r zmenou jeho ≈°t√Ωlu na 'block'.
- skryte v√Ωsledky, naƒç√≠tanie a clearBtn a nastavte ak√Ωkoƒævek text chyby na pr√°zdny re≈•azec.
- ak existuje kƒæ√∫ƒç a regi√≥n, spustite rutinu na:
  - volanie API na z√≠skanie √∫dajov o uhl√≠kovej spotrebe,
  - skrytie oblasti v√Ωsledkov,
  - skrytie formul√°ra,
  - zobrazenie tlaƒçidla reset.

Pred pokraƒçovan√≠m je u≈æitoƒçn√© nauƒçi≈• sa o veƒæmi d√¥le≈æitom koncepte dostupnom v prehliadaƒçoch: [LocalStorage](https://developer.mozilla.org/docs/Web/API/Window/localStorage). LocalStorage je u≈æitoƒçn√Ω sp√¥sob ukladania re≈•azcov v prehliadaƒçi ako `key-value` p√°r. Tento typ webov√©ho √∫lo≈æiska m√¥≈æe by≈• manipulovan√Ω pomocou JavaScriptu na spr√°vu √∫dajov v prehliadaƒçi. LocalStorage nevypr≈°√≠, zatiaƒæ ƒço SessionStorage, in√Ω typ webov√©ho √∫lo≈æiska, sa vyma≈æe pri zatvoren√≠ prehliadaƒça. R√¥zne typy √∫lo≈æiska maj√∫ svoje v√Ωhody a nev√Ωhody.

> Pozn√°mka - va≈°e roz≈°√≠renie prehliadaƒça m√° svoje vlastn√© lok√°lne √∫lo≈æisko; hlavn√© okno prehliadaƒça je in√° in≈°tancia a spr√°va sa samostatne.

Nastav√≠te hodnotu APIKey ako re≈•azec, napr√≠klad, a m√¥≈æete vidie≈•, ≈æe je nastaven√° v Edge prostredn√≠ctvom "in≈°pekcie" webovej str√°nky (m√¥≈æete klikn√∫≈• prav√Ωm tlaƒçidlom my≈°i na prehliadaƒç a zvoli≈• in≈°pekciu) a prejs≈• na kartu Aplik√°cie, aby ste videli √∫lo≈æisko.

![Panel lok√°lneho √∫lo≈æiska](../../../../translated_images/localstorage.472f8147b6a3f8d141d9551c95a2da610ac9a3c6a73d4a1c224081c98bae09d9.sk.png)

‚úÖ Prem√Ω≈°ƒæajte o situ√°ci√°ch, kedy by ste NECHCELI uklada≈• niektor√© √∫daje do LocalStorage. Vo v≈°eobecnosti je umiestnenie API kƒæ√∫ƒçov do LocalStorage zl√Ω n√°pad! Vid√≠te preƒço? V na≈°om pr√≠pade, keƒè≈æe na≈°a aplik√°cia je ƒçisto na uƒçenie a nebude nasaden√° do obchodu s aplik√°ciami, pou≈æijeme t√∫to met√≥du.

V≈°imnite si, ≈æe pou≈æ√≠vate Web API na manipul√°ciu s LocalStorage, buƒè pomocou `getItem()`, `setItem()`, alebo `removeItem()`. Je ≈°iroko podporovan√© naprieƒç prehliadaƒçmi.

Pred vytvoren√≠m funkcie `displayCarbonUsage()`, ktor√° je volan√° v `init()`, vytvorme funkciu na spracovanie poƒçiatoƒçn√©ho odoslania formul√°ra.

### Spracovanie odoslania formul√°ra

Vytvorte funkciu nazvan√∫ `handleSubmit`, ktor√° prij√≠ma argument udalosti `(e)`. Zastavte ≈°√≠renie udalosti (v tomto pr√≠pade chceme zastavi≈• prehliadaƒç od obnovenia) a zavolajte nov√∫ funkciu `setUpUser`, priƒçom odovzd√°te argumenty `apiKey.value` a `region.value`. T√Ωmto sp√¥sobom pou≈æijete dve hodnoty, ktor√© s√∫ prinesen√© prostredn√≠ctvom poƒçiatoƒçn√©ho formul√°ra, keƒè s√∫ pr√≠slu≈°n√© polia vyplnen√©.

```JavaScript
function handleSubmit(e) {
	e.preventDefault();
	setUpUser(apiKey.value, region.value);
}
```

‚úÖ Osvie≈æte si pam√§≈• - HTML, ktor√© ste nastavili v poslednej lekcii, m√° dve vstupn√© polia, ktor√Ωch `hodnoty` s√∫ zachyten√© prostredn√≠ctvom `const`, ktor√© ste nastavili na zaƒçiatku s√∫boru, a obe s√∫ `required`, tak≈æe prehliadaƒç zastav√≠ pou≈æ√≠vateƒæov od zadania null hodn√¥t.

### Nastavenie pou≈æ√≠vateƒæa

Pokraƒçujeme funkciou `setUpUser`, tu nastav√≠te hodnoty lok√°lneho √∫lo≈æiska pre apiKey a regionName. Pridajte nov√∫ funkciu:

```JavaScript
function setUpUser(apiKey, regionName) {
	localStorage.setItem('apiKey', apiKey);
	localStorage.setItem('regionName', regionName);
	loading.style.display = 'block';
	errors.textContent = '';
	clearBtn.style.display = 'block';
	//make initial call
	displayCarbonUsage(apiKey, regionName);
}
```

T√°to funkcia nastav√≠ naƒç√≠tavaciu spr√°vu, ktor√° sa zobraz√≠ poƒças volania API. V tomto bode ste dosiahli vytvorenie najd√¥le≈æitej≈°ej funkcie tohto roz≈°√≠renia prehliadaƒça!

### Zobrazenie uhl√≠kovej spotreby

Nakoniec je ƒças na dotazovanie API!

Pred pokraƒçovan√≠m by sme mali diskutova≈• o API. API, alebo [Application Programming Interfaces](https://www.webopedia.com/TERM/A/API.html), s√∫ kritick√Ωm prvkom n√°strojov webov√©ho v√Ωvoj√°ra. Poskytuj√∫ ≈°tandardn√© sp√¥soby, ako programy interaguj√∫ a rozhrania medzi sebou. Napr√≠klad, ak vytv√°rate webov√∫ str√°nku, ktor√° potrebuje dotazova≈• datab√°zu, niekto mohol vytvori≈• API, ktor√© m√¥≈æete pou≈æi≈•. Hoci existuje mnoho typov API, jedn√Ωm z najpopul√°rnej≈°√≠ch je [REST API](https://www.smashingmagazine.com/2018/01/understanding-using-rest-api/).

‚úÖ Term√≠n 'REST' znamen√° 'Representational State Transfer' a zah≈ï≈àa pou≈æ√≠vanie r√¥zne konfigurovan√Ωch URL na z√≠skanie √∫dajov. Urobte si mal√Ω prieskum o r√¥znych typoch API dostupn√Ωch pre v√Ωvoj√°rov. Ktor√Ω form√°t v√°s oslovuje?

Existuj√∫ d√¥le≈æit√© veci, ktor√© si treba v≈°imn√∫≈• o tejto funkcii. Po prv√©, v≈°imnite si [`async` kƒæ√∫ƒçov√© slovo](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function). P√≠sanie va≈°ich funkci√≠ tak, aby fungovali asynchr√≥nne, znamen√°, ≈æe ƒçakaj√∫ na dokonƒçenie akcie, ako je vr√°tenie √∫dajov, pred pokraƒçovan√≠m.

Tu je kr√°tke video o `async`:

[![Async a Await na spr√°vu sƒæubov](https://img.youtube.com/vi/YwmlRkrxvkk/0.jpg)](https://youtube.com/watch?v=YwmlRkrxvkk "Async a Await na spr√°vu sƒæubov")

> üé• Kliknite na obr√°zok vy≈°≈°ie pre video o async/await.

Vytvorte nov√∫ funkciu na dotazovanie C02Signal API:

```JavaScript
import axios from '../node_modules/axios';

async function displayCarbonUsage(apiKey, region) {
	try {
		await axios
			.get('https://api.co2signal.com/v1/latest', {
				params: {
					countryCode: region,
				},
				headers: {
					'auth-token': apiKey,
				},
			})
			.then((response) => {
				let CO2 = Math.floor(response.data.data.carbonIntensity);

				//calculateColor(CO2);

				loading.style.display = 'none';
				form.style.display = 'none';
				myregion.textContent = region;
				usage.textContent =
					Math.round(response.data.data.carbonIntensity) + ' grams (grams C02 emitted per kilowatt hour)';
				fossilfuel.textContent =
					response.data.data.fossilFuelPercentage.toFixed(2) +
					'% (percentage of fossil fuels used to generate electricity)';
				results.style.display = 'block';
			});
	} catch (error) {
		console.log(error);
		loading.style.display = 'none';
		results.style.display = 'none';
		errors.textContent = 'Sorry, we have no data for the region you have requested.';
	}
}
```

Toto je veƒæk√° funkcia. ƒåo sa tu deje?

- podƒæa najlep≈°√≠ch prakt√≠k pou≈æ√≠vate `async` kƒæ√∫ƒçov√© slovo, aby sa t√°to funkcia spr√°vala asynchr√≥nne. Funkcia obsahuje blok `try/catch`, preto≈æe vr√°ti sƒæub, keƒè API vr√°ti √∫daje. Keƒè≈æe nem√°te kontrolu nad r√Ωchlos≈•ou, akou API odpovie (m√¥≈æe neodpoveda≈• v√¥bec!), mus√≠te t√∫to neistotu rie≈°i≈• volan√≠m asynchr√≥nne.
- dotazujete API co2signal na z√≠skanie √∫dajov o va≈°om regi√≥ne, pomocou v√°≈°ho API kƒæ√∫ƒça. Na pou≈æitie tohto kƒæ√∫ƒça mus√≠te pou≈æi≈• typ autentifik√°cie vo svojich hlaviƒçkov√Ωch parametroch.
- keƒè API odpovie, prirad√≠te r√¥zne prvky jeho odpoved√≠ k ƒçastiam obrazovky, ktor√© ste nastavili na zobrazenie t√Ωchto √∫dajov.
- ak nastane chyba alebo neexistuje v√Ωsledok, zobraz√≠te chybov√∫ spr√°vu.

‚úÖ Pou≈æ√≠vanie asynchr√≥nnych programovac√≠ch vzorov je ƒèal≈°√≠m veƒæmi u≈æitoƒçn√Ωm n√°strojom vo va≈°ej v√Ωvoj√°rskej v√Ωbave. Preƒç√≠tajte si [o r√¥znych sp√¥soboch](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function), ako m√¥≈æete konfigurova≈• tento typ k√≥du.

Gratulujeme! Ak zostav√≠te svoje roz≈°√≠renie (`npm run build`) a obnov√≠te ho v paneli roz≈°√≠ren√≠, m√°te funkƒçn√© roz≈°√≠renie! Jedin√° vec, ktor√° nefunguje, je ikona, a t√∫ oprav√≠te v ƒèal≈°ej lekcii.

---

## üöÄ V√Ωzva

Diskutovali sme o niekoƒæk√Ωch typoch API v t√Ωchto lekci√°ch. Vyberte si webov√© API a presk√∫majte podrobne, ƒço pon√∫ka. Napr√≠klad sa pozrite na API dostupn√© v prehliadaƒçoch, ako je [HTML Drag and Drop API](https://developer.mozilla.org/docs/Web/API/HTML_Drag_and_Drop_API). ƒåo podƒæa v√°s rob√≠ API skvel√Ωm?

## Kv√≠z po predn√°≈°ke

[Kv√≠z po predn√°≈°ke](https://ff-quizzes.netlify.app/web/quiz/26)

## Prehƒæad a samostatn√© ≈°t√∫dium

V tejto lekcii ste sa nauƒçili o LocalStorage a API, oboch veƒæmi u≈æitoƒçn√Ωch pre profesion√°lneho webov√©ho v√Ωvoj√°ra. Dok√°≈æete prem√Ω≈°ƒæa≈• o tom, ako tieto dve veci spolupracuj√∫? Prem√Ω≈°ƒæajte o tom, ako by ste navrhli webov√∫ str√°nku, ktor√° by ukladala polo≈æky na pou≈æitie API.

## Zadanie

[Adoptujte API](assignment.md)

---

**Upozornenie**:  
Tento dokument bol prelo≈æen√Ω pomocou slu≈æby na automatick√Ω preklad [Co-op Translator](https://github.com/Azure/co-op-translator). Aj keƒè sa sna≈æ√≠me o presnos≈•, upozor≈àujeme, ≈æe automatick√© preklady m√¥≈æu obsahova≈• chyby alebo nepresnosti. P√¥vodn√Ω dokument v jeho p√¥vodnom jazyku by mal by≈• pova≈æovan√Ω za autoritat√≠vny zdroj. Pre d√¥le≈æit√© inform√°cie sa odpor√∫ƒça profesion√°lny ƒæudsk√Ω preklad. Nezodpoved√°me za ak√©koƒævek nedorozumenia alebo nespr√°vne interpret√°cie vypl√Ωvaj√∫ce z pou≈æitia tohto prekladu.