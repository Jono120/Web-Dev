<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "a7587943d38d095de8613e1b508609f5",
  "translation_date": "2025-08-29T12:31:57+00:00",
  "source_file": "5-browser-extension/2-forms-browsers-local-storage/README.md",
  "language_code": "hr"
}
-->
# Projekt pro≈°irenja preglednika, dio 2: Pozivanje API-ja, kori≈°tenje lokalne pohrane

## Kviz prije predavanja

[Kviz prije predavanja](https://ff-quizzes.netlify.app/web/quiz/25)

### Uvod

U ovoj lekciji pozvat ƒáete API slanjem obrasca va≈°eg pro≈°irenja preglednika i prikazati rezultate u pro≈°irenju. Osim toga, nauƒçit ƒáete kako pohraniti podatke u lokalnu pohranu preglednika za buduƒáu referencu i kori≈°tenje.

‚úÖ Slijedite numerirane segmente u odgovarajuƒáim datotekama kako biste znali gdje postaviti svoj kod.

### Postavljanje elemenata za manipulaciju u pro≈°irenju:

Do sada ste izradili HTML za obrazac i `<div>` za rezultate va≈°eg pro≈°irenja preglednika. Od sada ƒáete raditi u datoteci `/src/index.js` i graditi svoje pro≈°irenje korak po korak. Pogledajte [prethodnu lekciju](../1-about-browsers/README.md) za postavljanje projekta i proces izgradnje.

Radite u svojoj datoteci `index.js` i zapoƒçnite stvaranjem nekih `const` varijabli za pohranu vrijednosti povezanih s razliƒçitim poljima:

```JavaScript
// form fields
const form = document.querySelector('.form-data');
const region = document.querySelector('.region-name');
const apiKey = document.querySelector('.api-key');

// results
const errors = document.querySelector('.errors');
const loading = document.querySelector('.loading');
const results = document.querySelector('.result-container');
const usage = document.querySelector('.carbon-usage');
const fossilfuel = document.querySelector('.fossil-fuel');
const myregion = document.querySelector('.my-region');
const clearBtn = document.querySelector('.clear-btn');
```

Sva ova polja referenciraju se prema njihovoj CSS klasi, kako ste ih postavili u HTML-u u prethodnoj lekciji.

### Dodavanje slu≈°atelja dogaƒëaja

Zatim dodajte slu≈°atelje dogaƒëaja za obrazac i gumb za brisanje koji resetira obrazac, tako da se ne≈°to dogodi ako korisnik po≈°alje obrazac ili klikne na gumb za resetiranje. Dodajte poziv za inicijalizaciju aplikacije na dnu datoteke:

```JavaScript
form.addEventListener('submit', (e) => handleSubmit(e));
clearBtn.addEventListener('click', (e) => reset(e));
init();
```

‚úÖ Primijetite skraƒáeni naƒçin slu≈°anja dogaƒëaja slanja ili klika i kako se dogaƒëaj prosljeƒëuje funkcijama `handleSubmit` ili `reset`. Mo≈æete li napisati ekvivalent ovog skraƒáenog naƒçina u du≈æem formatu? Koji vam se vi≈°e sviƒëa?

### Izgradnja funkcija `init()` i `reset()`:

Sada ƒáete izgraditi funkciju koja inicijalizira pro≈°irenje, nazvanu `init()`:

```JavaScript
function init() {
	//if anything is in localStorage, pick it up
	const storedApiKey = localStorage.getItem('apiKey');
	const storedRegion = localStorage.getItem('regionName');

	//set icon to be generic green
	//todo

	if (storedApiKey === null || storedRegion === null) {
		//if we don't have the keys, show the form
		form.style.display = 'block';
		results.style.display = 'none';
		loading.style.display = 'none';
		clearBtn.style.display = 'none';
		errors.textContent = '';
	} else {
        //if we have saved keys/regions in localStorage, show results when they load
        displayCarbonUsage(storedApiKey, storedRegion);
		results.style.display = 'none';
		form.style.display = 'none';
		clearBtn.style.display = 'block';
	}
};

function reset(e) {
	e.preventDefault();
	//clear local storage for region only
	localStorage.removeItem('regionName');
	init();
}

```

U ovoj funkciji postoji zanimljiva logika. ƒåitajuƒái je, mo≈æete li vidjeti ≈°to se dogaƒëa?

- Postavljaju se dvije `const` varijable za provjeru je li korisnik pohranio APIKey i kod regije u lokalnu pohranu.
- Ako je bilo koja od njih null, prikazuje se obrazac promjenom njegovog stila na 'block'.
- Sakrivaju se rezultati, uƒçitavanje i `clearBtn`, a tekst gre≈°ke se postavlja na prazan string.
- Ako postoji kljuƒç i regija, zapoƒçinje rutina za:
  - pozivanje API-ja za dobivanje podataka o potro≈°nji ugljika,
  - sakrivanje podruƒçja rezultata,
  - sakrivanje obrasca,
  - prikaz gumba za resetiranje.

Prije nego ≈°to nastavimo, korisno je nauƒçiti o vrlo va≈ænom konceptu dostupnom u preglednicima: [LocalStorage](https://developer.mozilla.org/docs/Web/API/Window/localStorage). LocalStorage je koristan naƒçin za pohranu stringova u pregledniku kao `key-value` par. Ova vrsta web pohrane mo≈æe se manipulirati pomoƒáu JavaScripta za upravljanje podacima u pregledniku. LocalStorage ne istjeƒçe, dok se SessionStorage, druga vrsta web pohrane, bri≈°e kada se preglednik zatvori. Razliƒçite vrste pohrane imaju prednosti i nedostatke u svojoj upotrebi.

> Napomena - va≈°e pro≈°irenje preglednika ima vlastitu lokalnu pohranu; glavni prozor preglednika je druga instanca i pona≈°a se odvojeno.

Postavite svoj APIKey da ima vrijednost stringa, na primjer, i mo≈æete vidjeti da je postavljen u Edgeu "inspektiranjem" web stranice (mo≈æete desnim klikom na preglednik inspektirati) i odlaskom na karticu Applications za pregled pohrane.

![Lokalna pohrana](../../../../translated_images/localstorage.472f8147b6a3f8d141d9551c95a2da610ac9a3c6a73d4a1c224081c98bae09d9.hr.png)

‚úÖ Razmislite o situacijama u kojima NE biste ≈æeljeli pohraniti neke podatke u LocalStorage. Opƒáenito, postavljanje API kljuƒçeva u LocalStorage je lo≈°a ideja! Vidite li za≈°to? U na≈°em sluƒçaju, buduƒái da je na≈°a aplikacija iskljuƒçivo za uƒçenje i neƒáe biti objavljena u trgovini aplikacija, koristit ƒáemo ovu metodu.

Primijetite da koristite Web API za manipulaciju LocalStorageom, bilo pomoƒáu `getItem()`, `setItem()` ili `removeItem()`. ≈†iroko je podr≈æan u preglednicima.

Prije nego ≈°to izgradite funkciju `displayCarbonUsage()` koja se poziva u `init()`, izgradimo funkcionalnost za rukovanje poƒçetnim slanjem obrasca.

### Rukovanje slanjem obrasca

Izradite funkciju nazvanu `handleSubmit` koja prihvaƒáa argument dogaƒëaja `(e)`. Zaustavite propagaciju dogaƒëaja (u ovom sluƒçaju ≈æelimo zaustaviti osvje≈æavanje preglednika) i pozovite novu funkciju, `setUpUser`, prosljeƒëujuƒái argumente `apiKey.value` i `region.value`. Na taj naƒçin koristite dvije vrijednosti koje se unose putem poƒçetnog obrasca kada se odgovarajuƒáa polja popune.

```JavaScript
function handleSubmit(e) {
	e.preventDefault();
	setUpUser(apiKey.value, region.value);
}
```

‚úÖ Osvje≈æite svoje pamƒáenje - HTML koji ste postavili u pro≈°loj lekciji ima dva polja za unos ƒçije se `vrijednosti` hvataju putem `const` varijabli koje ste postavili na vrhu datoteke, a oba su `required`, tako da preglednik sprjeƒçava korisnike da unesu null vrijednosti.

### Postavljanje korisnika

Nastavljajuƒái s funkcijom `setUpUser`, ovdje postavljate vrijednosti lokalne pohrane za apiKey i regionName. Dodajte novu funkciju:

```JavaScript
function setUpUser(apiKey, regionName) {
	localStorage.setItem('apiKey', apiKey);
	localStorage.setItem('regionName', regionName);
	loading.style.display = 'block';
	errors.textContent = '';
	clearBtn.style.display = 'block';
	//make initial call
	displayCarbonUsage(apiKey, regionName);
}
```

Ova funkcija postavlja poruku uƒçitavanja koja se prikazuje dok se API poziva. U ovom trenutku stigli ste do stvaranja najva≈ænije funkcije ovog pro≈°irenja preglednika!

### Prikaz potro≈°nje ugljika

Napokon, vrijeme je za upit API-ja!

Prije nego ≈°to nastavimo, trebali bismo razgovarati o API-jima. API-ji, ili [Application Programming Interfaces](https://www.webopedia.com/TERM/A/API.html), kljuƒçni su element alata web programera. Oni pru≈æaju standardne naƒçine za programe da meƒëusobno komuniciraju i povezuju se. Na primjer, ako gradite web stranicu koja treba upit prema bazi podataka, netko je mo≈æda stvorio API koji mo≈æete koristiti. Iako postoji mnogo vrsta API-ja, jedan od najpopularnijih je [REST API](https://www.smashingmagazine.com/2018/01/understanding-using-rest-api/).

‚úÖ Pojam 'REST' oznaƒçava 'Representational State Transfer' i ukljuƒçuje kori≈°tenje razliƒçito konfiguriranih URL-ova za dohvaƒáanje podataka. Malo istra≈æite o razliƒçitim vrstama API-ja dostupnih programerima. Koji format vam se ƒçini privlaƒçnim?

Postoje va≈æne stvari koje treba primijetiti o ovoj funkciji. Prvo, primijetite kljuƒçnu rijeƒç [`async`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function). Pisanje va≈°ih funkcija tako da rade asinkrono znaƒçi da ƒçekaju da se neka radnja, poput vraƒáanja podataka, dovr≈°i prije nego ≈°to nastave.

Evo kratkog videa o `async`:

[![Async i Await za upravljanje obeƒáanjima](https://img.youtube.com/vi/YwmlRkrxvkk/0.jpg)](https://youtube.com/watch?v=YwmlRkrxvkk "Async i Await za upravljanje obeƒáanjima")

> üé• Kliknite na sliku iznad za video o async/await.

Izradite novu funkciju za upit prema C02Signal API-ju:

```JavaScript
import axios from '../node_modules/axios';

async function displayCarbonUsage(apiKey, region) {
	try {
		await axios
			.get('https://api.co2signal.com/v1/latest', {
				params: {
					countryCode: region,
				},
				headers: {
					'auth-token': apiKey,
				},
			})
			.then((response) => {
				let CO2 = Math.floor(response.data.data.carbonIntensity);

				//calculateColor(CO2);

				loading.style.display = 'none';
				form.style.display = 'none';
				myregion.textContent = region;
				usage.textContent =
					Math.round(response.data.data.carbonIntensity) + ' grams (grams C02 emitted per kilowatt hour)';
				fossilfuel.textContent =
					response.data.data.fossilFuelPercentage.toFixed(2) +
					'% (percentage of fossil fuels used to generate electricity)';
				results.style.display = 'block';
			});
	} catch (error) {
		console.log(error);
		loading.style.display = 'none';
		results.style.display = 'none';
		errors.textContent = 'Sorry, we have no data for the region you have requested.';
	}
}
```

Ovo je velika funkcija. ≈†to se ovdje dogaƒëa?

- Slijedeƒái najbolje prakse, koristite kljuƒçnu rijeƒç `async` kako bi se funkcija pona≈°ala asinkrono. Funkcija sadr≈æi blok `try/catch` jer ƒáe vratiti obeƒáanje kada API vrati podatke. Buduƒái da nemate kontrolu nad brzinom kojom ƒáe API odgovoriti (mo≈æda uopƒáe neƒáe odgovoriti!), morate upravljati ovom neizvjesno≈°ƒáu pozivanjem asinkrono.
- Upitujete co2signal API za dobivanje podataka o regiji, koristeƒái svoj API kljuƒç. Da biste koristili taj kljuƒç, morate koristiti vrstu autentifikacije u parametrima zaglavlja.
- Kada API odgovori, dodjeljujete razliƒçite elemente njegovih podataka odgovora dijelovima ekrana koje ste postavili za prikaz tih podataka.
- Ako postoji gre≈°ka ili nema rezultata, prikazujete poruku o gre≈°ci.

‚úÖ Kori≈°tenje asinkronih obrazaca programiranja jo≈° je jedan vrlo koristan alat u va≈°em alatu. Proƒçitajte [o razliƒçitim naƒçinima](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function) na koje mo≈æete konfigurirati ovu vrstu koda.

ƒåestitamo! Ako izgradite svoje pro≈°irenje (`npm run build`) i osvje≈æite ga u svom panelu pro≈°irenja, imate funkcionalno pro≈°irenje! Jedina stvar koja ne radi je ikona, a to ƒáete popraviti u sljedeƒáoj lekciji.

---

## üöÄ Izazov

Razgovarali smo o nekoliko vrsta API-ja u ovim lekcijama. Odaberite web API i istra≈æite detaljno ≈°to nudi. Na primjer, pogledajte API-je dostupne unutar preglednika, poput [HTML Drag and Drop API](https://developer.mozilla.org/docs/Web/API/HTML_Drag_and_Drop_API). ≈†to ƒçini dobar API prema va≈°em mi≈°ljenju?

## Kviz nakon predavanja

[Kviz nakon predavanja](https://ff-quizzes.netlify.app/web/quiz/26)

## Pregled i samostalno uƒçenje

U ovoj lekciji ste nauƒçili o LocalStorageu i API-jima, oba vrlo korisna za profesionalnog web programera. Mo≈æete li razmisliti o tome kako ove dvije stvari rade zajedno? Razmislite o tome kako biste osmislili web stranicu koja bi pohranjivala stavke koje koristi API.

## Zadatak

[Usvojite API](assignment.md)

---

**Odricanje od odgovornosti**:  
Ovaj dokument je preveden pomoƒáu AI usluge za prevoƒëenje [Co-op Translator](https://github.com/Azure/co-op-translator). Iako nastojimo osigurati toƒçnost, imajte na umu da automatski prijevodi mogu sadr≈æavati pogre≈°ke ili netoƒçnosti. Izvorni dokument na izvornom jeziku treba smatrati autoritativnim izvorom. Za kljuƒçne informacije preporuƒçuje se profesionalni prijevod od strane ƒçovjeka. Ne preuzimamo odgovornost za bilo kakve nesporazume ili pogre≈°ne interpretacije koje proizlaze iz kori≈°tenja ovog prijevoda.